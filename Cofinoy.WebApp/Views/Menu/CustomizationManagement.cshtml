@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    ViewData["Title"] = "Addons Management";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customization Management</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="~/css/CustomizationManagement.css" asp-append-version="true" />
</head>
<body>
    <div class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Customization Management</h1>
            <p class="addons-count">Loading customizations...</p>
        </div>

        <div class="controls-section">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" placeholder="Search customizations...">
                <button class="btn btn-primary add-addon-btn">
                    <i class="fas fa-plus"></i>
                    Add Customization
                </button>
            </div>
            <div class="action-buttons">
                <button class="btn btn-secondary filter-btn">
                    <svg width="15" height="15" viewBox="0 0 31 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M1.83333 20.75C1.34931 20.75 0.943576 20.5863 0.616146 20.2589C0.288715 19.9314 0.125 19.5257 0.125 19.0417C0.125 18.5576 0.288715 18.1519 0.616146 17.8245C0.943576 17.497 1.34931 17.3333 1.83333 17.3333H8.66667C9.15069 17.3333 9.55642 17.497 9.88385 17.8245C10.2113 18.1519 10.375 18.5576 10.375 19.0417C10.375 19.5257 10.2113 19.9314 9.88385 20.2589C9.55642 20.5863 9.15069 20.75 8.66667 20.75H1.83333ZM1.83333 12.2083C1.34931 12.2083 0.943576 12.0446 0.616146 11.7172C0.288715 11.3898 0.125 10.984 0.125 10.5C0.125 10.016 0.288715 9.61024 0.616146 9.28281C0.943576 8.95538 1.34931 8.79167 1.83333 8.79167H18.9167C19.4007 8.79167 19.8064 8.95538 20.1339 9.28281C20.4613 9.61024 20.625 10.016 20.625 10.5C20.625 10.984 20.4613 11.3898 20.1339 11.7172C19.8064 12.0446 19.4007 12.2083 18.9167 12.2083H1.83333ZM1.83333 3.66667C1.34931 3.66667 0.943576 3.50295 0.616146 3.17552C0.288715 2.84809 0.125 2.44236 0.125 1.95833C0.125 1.47431 0.288715 1.06858 0.616146 0.741146C0.943576 0.413715 1.34931 0.25 1.83333 0.25H29.1667C29.6507 0.25 30.0564 0.413715 30.3839 0.741146C30.7113 1.06858 30.875 1.47431 30.875 1.95833C30.875 2.44236 30.7113 2.84809 30.3839 3.17552C30.0564 3.50295 29.6507 3.66667 29.1667 3.66667H1.83333Z" fill="#322708" />
                    </svg>
                    Filter
                </button>
            </div>
        </div>

        <div id="filterModal" class="modal-overlay filter-modal">
            <div class="modal-container">
                <div class="modal-header">
                    <h2>Filter Customizations</h2>
                    <button class="modal-close" id="closeFilterModal">×</button>
                </div>
                <div class="modal-body">
                    <div class="filter-content">
                        <div class="filter-group">
                            <label>Filter by Type:</label>
                            <select id="typeFilter">
                                <option value="">All Types</option>
                                <option value="single_select">Single Select</option>
                                <option value="multi_select">Multi Select</option>
                                <option value="quantity">Quantity</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Filter by Required:</label>
                            <select id="requiredFilter">
                                <option value="">All</option>
                                <option value="true">Required Only</option>
                                <option value="false">Optional Only</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary clear-filters-btn">Clear Filters</button>
                    <button class="btn btn-primary apply-filters-btn">Apply Filters</button>
                </div>
            </div>
        </div>

        <div class="addons-grid">
        </div>

        <!-- Circular progress bar for loading state -->
        <div id="loadingProgress" class="loading-progress" style="display:none;">
            <div class="circular-progress">
                <svg width="120" height="120" viewBox="0 0 120 120">
                    <circle class="progress-circle-bg" cx="60" cy="60" r="45"></circle>
                    <circle class="progress-circle" cx="60" cy="60" r="45"></circle>
                </svg>
            </div>
            <p class="loading-text">Loading customizations...</p>
        </div>
    </div>

    <div id="addAddonModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h2 id="modalTitle">Add new customization</h2>
                <button class="modal-close" id="closeModal">×</button>
            </div>

            <div class="modal-body">
                <form id="addAddonForm">
                    <input type="hidden" id="editingAddonId" value="">

                    <div class="form-row">
                        <div class="form-group">
                            <label class="modal-subheader">Customization Name *</label>
                            <input type="text" id="addonName" placeholder="e.g., Milk Type, Size, Temperature" maxlength="100" required>
                        </div>
                        <div class="form-group">
                            <label class="modal-subheader">Display Order *</label>
                            <input type="number" id="displayOrder" placeholder="1, 2, 3..." min="1" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="modal-subheader">Type *</label>
                            <select id="addonType" required>
                                <option value="">Select type...</option>
                                <option value="single_select">Single Select</option>
                                <option value="multi_select">Multi Select</option>
                                <option value="quantity">Quantity</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="modal-subheader">Required *</label>
                            <select id="isRequired" required>
                                <option value="false">No</option>
                                <option value="true">Yes</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group full-width">
                            <label>Description</label>
                            <input type="text" id="addonDescription" placeholder="Brief description (optional)" maxlength="500">
                        </div>
                    </div>

                    <div id="quantitySettings" class="quantity-settings" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Max Quantity (1-100) *</label>
                                <input type="number" id="maxQuantity" placeholder="100" min="1" max="100" required>
                            </div>
                            <div class="form-group">
                                <label>Price Per Unit (₱) (0-1000) *</label>
                                <input type="number" id="pricePerUnit" placeholder="0.00" step="0.01" min="0" max="1000" required>
                            </div>
                        </div>
                    </div>

                    <div id="optionsSection" class="form-group" style="display: none;">
                        <label class="modal-subheader">Options *</label>
                        <p class="form-helper">Add at least one option for customers to choose from.</p>
                        <div class="options-container">
                            <div class="options-header">
                                <button type="button" class="btn btn-secondary add-option-btn">
                                    <i class="fas fa-plus"></i>
                                    Add Option
                                </button>
                            </div>
                            <div class="options-list" id="optionsList">
                            </div>
                        </div>
                        <div id="optionsError" class="error-message" style="display: none;">
                            Please add at least one option for this customization type.
                        </div>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
                <button type="submit" class="btn btn-primary" id="saveAddonBtn" form="addAddonForm">
                    <i class="fas fa-plus"></i>
                    <span id="saveAddonBtnText">Add Customization</span>
                </button>
            </div>
        </div>
    </div>

    <div id="deleteConfirmModal" class="modal-overlay delete-modal">
        <div class="modal-container delete-modal-container">
            <div class="modal-header delete-modal-header">
                <div class="delete-icon-wrapper">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
            </div>
            <div class="modal-body delete-modal-body">
                <h2 class="delete-modal-title">Delete Customization?</h2>
                <p class="delete-modal-message">Are you sure you want to delete "<strong id="deleteAddonName"></strong>"? This action cannot be undone.</p>
            </div>
            <div class="modal-footer delete-modal-footer">
                <button class="btn btn-secondary" id="cancelDeleteBtn">Cancel</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">
                    <i class="fas fa-trash"></i>
                    Delete
                </button>
            </div>
        </div>
    </div>

    @Html.Partial("_Toast")

    <script defer src="~/js/customizationManagement.js"></script>
</body>
</html>